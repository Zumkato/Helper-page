"""Dashboard page listing projects and allowing creation."""

from __future__ import annotations

import reflex as rx

from ...state.project_state import ProjectState


def _project_item(project: dict) -> rx.Component:
    """Display a single project as a link."""
    return rx.link(
        rx.box(
            rx.heading(project["name"], size="md"),
            rx.text(project.get("description", ""), font_size="sm"),
            border="1px solid", padding="0.5em", margin_y="0.25em",
        ),
        href=f"/project/{project['id']}",
    )


def dashboard_page() -> rx.Component:
    """Render the dashboard page."""
    return rx.vstack(
        rx.heading("Projects", size="lg"),
        rx.foreach(ProjectState.projects, _project_item),
        rx.form(
            rx.vstack(
                rx.input(name="name", placeholder="Name", width="100%"),
                rx.textarea(name="description", placeholder="Description", width="100%"),
                rx.button("Create", type="submit"),
            ),
            on_submit=ProjectState.handle_create_project,
        ),
        rx.foreach(ProjectState.toasts, lambda m: rx.text(m, color="green")),
    )
